<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quartier RP Mobile</title>
<style>
body{margin:0;overflow:hidden;font-family:sans-serif;}
#gameCanvas{background:#222;display:block;}
#hud{position:absolute;top:10px;left:10px;color:white;font-size:16px;}
#inventoryBtn{position:absolute;top:10px;right:10px;padding:10px;background:#555;color:white;border:none;border-radius:5px;}
#joystickBase{position:absolute;bottom:50px;left:50px;width:100px;height:100px;background:rgba(255,255,255,0.2);border-radius:50%;touch-action:none;}
#joystickKnob{position:absolute;width:50px;height:50px;background:rgba(255,255,255,0.6);border-radius:50%;touch-action:none;}
#inventory{position:absolute;top:50px;right:10px;background:#333;color:white;padding:10px;display:none;border-radius:5px;}
</style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="hud">
  Santé: <span id="health">100</span>%<br>
  Faim: <span id="hunger">100</span>%<br>
  Soif: <span id="thirst">100</span>%<br>
  Crédits: <span id="money">100</span>
</div>
<button id="inventoryBtn">Inventaire</button>
<div id="inventory">
  <ul id="inventoryList"></ul>
</div>

<div id="joystickBase">
  <div id="joystickKnob"></div>
</div>

<script>
// ===== Jeu setup =====
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
const width=canvas.width, height=canvas.height;
let keys={};
let isMobile=false;
let inventory=[];

// ===== Joueur =====
const player={x:100,y:100,width:32,height:32,speed:2,health:100,hunger:100,thirst:100,money:100};

// ===== PNJ =====
const npcs=[
  {x:300,y:200,width:32,height:32,type:'commerçant',name:'Magasin'},
  {x:500,y:400,width:32,height:32,type:'voisin',name:'Voisin'},
  {x:600,y:150,width:32,height:32,type:'ruelle',name:'Ruelle Illégale'}
];

// ===== Mini-jeux / Missions =====
function startMission(type){
  if(type==='livraison'){
    alert('Mission Livraison : Va au magasin ! +50 crédits');
    player.money+=50;
    updateHUD();
  } else if(type==='ruelle'){
    let success=Math.random()<0.5;
    if(success){alert('Mission Ruelle Réussie ! +100 crédits'); player.money+=100;}
    else{alert('Mission Ruelle Ratée ! -10 santé'); player.health=Math.max(0,player.health-10);}
    updateHUD();
  }
}

// ===== HUD =====
function updateHUD(){
  document.getElementById('health').innerText=Math.round(player.health);
  document.getElementById('hunger').innerText=Math.round(player.hunger);
  document.getElementById('thirst').innerText=Math.round(player.thirst);
  document.getElementById('money').innerText=player.money;
}

// ===== Inventaire =====
document.getElementById('inventoryBtn').addEventListener('click',()=>{
  const inv=document.getElementById('inventory');
  inv.style.display=inv.style.display==='none'?'block':'none';
  const list=document.getElementById('inventoryList');
  list.innerHTML='';
  inventory.forEach(item=>{let li=document.createElement('li'); li.innerText=item; list.appendChild(li);});
});

// ===== Déplacement =====
document.addEventListener('keydown',e=>keys[e.key]=true);
document.addEventListener('keyup',e=>keys[e.key]=false);

// ===== Joystick mobile =====
const joystickBase=document.getElementById('joystickBase');
const joystickKnob=document.getElementById('joystickKnob');
let joystickActive=false, startX=50+50, startY=window.innerHeight-50-50;
joystickBase.addEventListener('touchstart',e=>joystickActive=true);
joystickBase.addEventListener('touchmove',e=>{
  if(!joystickActive)return;
  const t=e.touches[0]; 
  const dx=t.clientX-startX;
  const dy=t.clientY-startY;
  const maxDist=50;
  const dist=Math.min(Math.sqrt(dx*dx+dy*dy),maxDist);
  const angle=Math.atan2(dy,dx);
  player.x+=Math.cos(angle)*dist/5;
  player.y+=Math.sin(angle)*dist/5;
  joystickKnob.style.left=(startX+Math.cos(angle)*dist-25)+'px';
  joystickKnob.style.top=(startY+Math.sin(angle)*dist-25)+'px';
});
joystickBase.addEventListener('touchend',e=>{joystickActive=false; joystickKnob.style.left=(startX-25)+'px'; joystickKnob.style.top=(startY-25)+'px';});

// ===== Dessin =====
function draw(){
  ctx.clearRect(0,0,width,height);
  // Joueur
  ctx.fillStyle='blue';
  ctx.fillRect(player.x,player.y,player.width,player.height);
  // PNJ
  ctx.fillStyle='green';
  npcs.forEach(npc=>{
    ctx.fillRect(npc.x,npc.y,npc.width,npc.height);
  });
}

// ===== Interactions =====
function checkInteractions(){
  npcs.forEach(npc=>{
    if(Math.abs(player.x-npc.x)<32 && Math.abs(player.y-npc.y)<32){
      if(npc.type==='commerçant') startMission('livraison');
      else if(npc.type==='ruelle') startMission('ruelle');
    }
  });
}

// ===== Game loop =====
function gameLoop(){
  if(!isMobile){
    if(keys['ArrowUp']) player.y-=player.speed;
    if(keys['ArrowDown']) player.y+=player.speed;
    if(keys['ArrowLeft']) player.x-=player.speed;
    if(keys['ArrowRight']) player.x+=player.speed;
  }
  draw();
  checkInteractions();
  updateHUD();
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>

</body>
</html>
